$(function(){var a=$(".datepair input.date").each(function(){var h=$(this);var g={minDate:0};if(h.hasClass("future")){g.minDate=new Date()}if(h.hasClass("start")||h.hasClass("end")){g.onSelect=f}h.datepicker(g)});var c=$(".datepair input.time").each(function(){var h=$(this);var g={showDuration:true,timeFormat:"H:i"};if(h.hasClass("start")||h.hasClass("end")){g.onSelect=f}h.timepicker(g)});$(".datepair").each(b);function b(){var h=$(this);var m=h.find("input.start.date");var i=h.find("input.end.date");var k=0;if(m.length&&i.length){var j=new Date(m.datepicker("getDate"));var n=new Date(i.datepicker("getDate"));k=n.getTime()-j.getTime();h.data("dateDelta",k)}var g=h.find("input.start.time");var o=h.find("input.end.time");if(g.length&&o.length){var l=g.timepicker("getSecondsFromMidnight");var p=o.timepicker("getSecondsFromMidnight");h.data("timeDelta",p-l);if(k<86400000){o.timepicker("option","minTime",l)}}}function f(){var h=$(this);var g=h.closest(".datepair");if(h.hasClass("date")){d(h,g)}else{if(h.hasClass("time")){e(h,g)}}}function d(p,i){var j=i.find("input.start.date");var n=i.find("input.end.date");if(!j.length||!n.length){return}var l=new Date(j.datepicker("getDate"));var o=new Date(n.datepicker("getDate"));var h=i.data("dateDelta");if(h&&p.hasClass("start")){var m=new Date(l.getTime()+h);n.datepicker("setDate",m);return}else{var k=o.getTime()-l.getTime();if(k<0){k=0;if(p.hasClass("start")){n.datepicker("setDate",l)}else{if(p.hasClass("end")){j.datepicker("setDate",o)}}}if(k<86400000){var g=i.find("input.start.time").val();if(g){i.find("input.end.time").timepicker("option",{minTime:g})}}else{i.find("input.end.time").timepicker("option",{minTime:null})}i.data("dateDelta",k)}}function e(q,i){var j=i.find("input.start.time");var n=i.find("input.end.time");if(!j.length||!n.length){return}var o=j.timepicker("getSecondsFromMidnight");var t=n.timepicker("getSecondsFromMidnight");var h=i.data("timeDelta");var m=i.data("dateDelta");if(q.hasClass("start")&&(!m||m<86400000)){n.timepicker("option","minTime",o)}var s=0;var k;if(h&&q.hasClass("start")){var l=(o+h)%86400;if(l<0){l+=86400}n.timepicker("setTime",l);k=l-o}else{if(o!==null&&t!==null){k=t-o}else{return}}i.data("timeDelta",k);if(k<0&&(!h||h>0)){var s=86400000}else{if(k>0&&h<0){var s=-86400000}}var g=i.find(".start.date");var r=i.find(".end.date");if(g.val()&&!r.val()){r.datepicker("setDate",g.val());m=0;i.data("dateDelta",0)}if(s!=0){if(m||m===0){var p=new Date(r.datepicker("getDate"));var l=new Date(p.getTime()+s);r.datepicker("setDate",l);i.data("dateDelta",m+s)}}}});
$(function(){$.datepicker.setDefaults(i18n.node("ui.datepicker"));var a=$(".datepicker").datepicker({minDate:0,changeMonths:true,onSelect:function(d){var e=$(this).hasClass("datepicker_date-from")?"minDate":"maxDate",b=$(this).data("datepicker"),c=$.datepicker.parseDate(b.settings.dateFormat||$.datepicker._defaults.dateFormat,d,b.settings);a.not(this).datepicker("option",e,c)}});$(".timepicker").timepicker({timeFormat:"H:i",step:30,scrollDefaultNow:"10:00"})});
Interface=function(){this.showNodeAsFlashMessage=function(a){$(".b-flash-container").append($(a))};this.showTemplateAsFlashMessage=function(c,a){var b=tmpl.render(c,a);if(b){this.showNodeAsFlashMessage(b)}else{this.showNodeAsFlashMessage($("#"+c).tmpl(a))}};$("textarea.auto-resize").live("change focus",function(){$(this).autosize()});$("input[type=file]").change(function(){$("#file-input-replacement").val($(this).val())});$(".js-auth-signup-link").click(function(a){a.preventDefault();if($(".js-auth-signup-box").is(":visible")){$(".js-auth-signup-box").slideUp()}else{$(".js-auth-login-box").slideUp();$(".js-auth-signup-box").slideDown()}});$(".js-auth-login-link").click(function(a){a.preventDefault();if($(".js-auth-login-box").is(":visible")){$(".js-auth-login-box").slideUp()}else{$(".js-auth-signup-box").slideUp();$(".js-auth-login-box").slideDown()}});$(".js-signup-frist-course-social-btn").click(function(){$('input[name^="CoursePlusUserForm[user]"]').removeAttr("required")});$(".js-signup-frist-course-btn").click(function(){$('input[name^="CoursePlusUserForm[user]"]').attr("required","required")});$(".js-website-create_course_form_options_link").live("click",function(a){a.preventDefault();$(".js-create_course_additional_options").slideToggle()});$(".js-website-create_lectrio_account_link").live("click",function(a){a.preventDefault();$(".js-create_course_user_additional_options").slideToggle()});$(".alert").alert();return this}();
Interface.discussions=function(){var d=$.url().segment(2);var i=$(".b-discussion-container").attr("discussionId");if(i){g(i);f(i)}else{}$(".b-discussion-comment__footer .anchor").live("click",function(){$(this).parents(".b-discussion-reply-form").slideToggle("fast");return false});$(".b-discussion-reply-form_global").submit(function(){var j=$(this).serializeArray();if(i){b(j)}else{e(j)}return false});function h(){$(".b-discussion-reply-form").submit(function(){var j=$(this).serializeArray();b(j);return false})}function e(j){$.ajax({type:"POST",url:"/ajax/discussion/create-discussion",data:j,success:function(k){i=k.response["discussionId"];j[3]["value"]=i;$("#discussionId").val(i);b(j)}})}function b(j){if(j[0]["value"]!=""){$.ajax({type:"POST",url:"/ajax/discussion/comment/add",data:j,success:function(){g(i)}})}}function g(j){$.ajax({type:"POST",url:"/ajax/discussion/"+j+"/comment/get",data:{courseId:d},success:function(k){$container=$(".b-discussion-container");$container.html(k);$container.toggleClass("b-discussion-container_not-empty",$container.find(".b-discussion-comment").size()!=0);$(".b-discussion-global-reply-container textarea").val("");$(".b-discussion-comment div").hover(function(){$(this).children().find(".b-discussion-comment__footer__reply").first().toggle(0);$(this).children().find(".b-discussion-comment__header__delete").first().toggle(0)});$(".b-discussion-comment__footer__reply").click(function(){var l=$(this).parent().parent().find(".b-discussion-reply-form").first();l.slideToggle("fast");return false});$(".b-discussion-comment__header__delete").click(function(){a($(this).attr("commentId"));$(this).parent().parent().html('<div class="deleted label">Comment was deleted</div>');return false});$(".b-discussion-comment__text").each(function(){var l=$(this);txt=l.html();l.html(linkify(txt))});$(".attributes a, .b-discussion-comment__text a, .b-news-element__content a").attr("target","_blank");h(h);c()}})}function f(j){$.ajax({type:"POST",url:"/ajax/discussion/mark-as-read",data:{discussionId:j},success:function(){}})}function a(j){$.ajax({type:"POST",async:false,url:"/ajax/discussion/comment/delete",data:{discussionCommentId:j},success:function(){}})}function c(){var j=$.url().attr("anchor");if(j&&j.substr(0,8)=="comment_"&&$("#"+j)){$("html,body").animate({scrollTop:$("#"+j).offset().top},"fast")}}};
Interface.enableTitleRename=function(){var b=$(".b-title-tab__rename-container input");var a="";b.click(function(){$(".b-title-tab__rename-submit-button").css("display","block");a=b.val()});b.blur(function(){if(a==b.val()){$(".b-title-tab__rename-submit-button").css("display","none")}})};
Interface.userStack=(function(){var a;var b={};b.init=function(e){a=$.extend({defaultAjaxData:{},customAddUser:null,customRemoveUser:null,hookAfterAdd:null,hookAfterRemove:null},e);var c=function(j,i,l){var k=g(j);if(typeof l=="undefined"||_.trim(l)==""){l=""}var h=a.defaultAjaxData;$.ajax({type:"POST",url:i,data:h,success:function(m){if(typeof m.response!="undefined"){users=m.response;f(j,l);if(users.length!=0){$users=tmpl.render("user-stack:"+k+"__user",users);$users.each(function(n){$(this).data("user",users[n])});j.html($users)}}}})};var g=function(h){var i=h.parent().attr("class");return i.substr(i.indexOf("__")+2)};var f=function(h,j){var i=g(h);if(typeof j=="undefined"||_.trim(j)==""){j=""}h.find("li.empty").remove();if(h.find("li").size()==0){tmpl.render("user-stack:"+i+"__empty"+((j=="")?"":"_search")).appendTo(h)}};var d=function(j){var i=j.path;var h=$.extend(a.defaultAjaxData,{userId:j.$target.data("user").id,},j.customAjaxData);$detachedAction=j.$target.find(".b-rounded-list-item_user-stack__action").detach();j.$target.prepend('<span class="b-rounded-list-item_user-stack__action b-rounded-list-item_user-stack__action_loader"></span>');$.ajax({type:"POST",url:i,data:h,success:function(l){if(typeof l.response!="undefined"){if(j.type=="remove"&&_.isFunction(a.hookAfterRemove)){hookOutput=a.hookAfterRemove(j.$target,l.response)}if(j.type=="add"&&_.isFunction(a.hookAfterAdd)){hookOutput=a.hookAfterAdd(j.$target,l.response)}var k=j.$target.data("user");$detachedAction.remove();$ulFrom=j.$target.parent();$ulTo=$(j.toSelector);$user=tmpl.render(j.templateId,[k]);$user.data("user",k);j.$target.remove();$ulTo.prepend($user);f($ulFrom);f($ulTo)}},error:function(k){j.$target.prepend($detachedAction);j.$target.find(".b-rounded-list-item_user-stack__action_loader").remove();Interface.showTemplateAsFlashMessage("user-stack:flash_error-save")}});return false};b.removeUser=function(h,i){return d({templateId:"user-stack:candidates__user",toSelector:".b-user-stack__candidates ul",path:a.removeUserPath,customAjaxData:i,$target:h,type:"remove"})};b.addUser=function(h,i){return d({templateId:"user-stack:members__user",toSelector:".b-user-stack__members ul",path:a.addUserPath,customAjaxData:i,$target:h,type:"add",})};$(".b-rounded-list-item_user-stack__action_add").live("click",function(){var h=$(this).parent().parent();if(_.isFunction(a.customAddUser)){return a.customAddUser(h)}else{return b.addUser(h)}});$(".b-rounded-list-item_user-stack__action_remove").live("click",function(){var h=$(this).parent().parent();if(_.isFunction(a.customRemoveUser)){return a.customRemoveUser(h)}else{return b.removeUser(h)}});c($(".b-user-stack__members ul"),a.updateMembersPath,"");c($(".b-user-stack__candidates ul"),a.updateCandidatesPath,"")};return b})();
tmpl=(function(){var a={};a.autoload=[];a.render=function(c,d,b){$result=$.tmpl(c,d,b);if($result.text().indexOf(c)==0){c=$("#"+c.replace(":","\\:"));$result=$.tmpl(c,d,b)}if($result.text().indexOf(c)==0){$result=$()}return $result};a.loadCollection=function(b){$.ajax({url:"/tmpl/"+b+".html",success:function(c){$(c).each(function(e,d){var g=$(d);var f=g.attr("id");if(f){$.template(f,g.html())}})},async:false})};$(function(){$.each(a.autoload,function(c,b){a.loadCollection(b)})});return a})();tmpl.autoload=["all"];
function Page(){}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){if(this==null){throw new TypeError()}var d=Object(this);var a=d.length>>>0;if(a===0){return -1}var e=0;if(arguments.length>0){e=Number(arguments[1]);if(e!=e){e=0}else{if(e!=0&&e!=Infinity&&e!=-Infinity){e=(e>0||-1)*Math.floor(Math.abs(e))}}}if(e>=a){return -1}var b=e>=0?e:Math.max(a-Math.abs(e),0);for(;b<a;b++){if(b in d&&d[b]===c){return b}}return -1}}$(document).ready(function(){Page.initialize()});Page.initialize=function(){if(typeof _=="undefined"){Page.promptReload()}if(_.isUndefined($)){Page.promptReload()}$(document.documentElement).removeClass("nojs").addClass("js");for(var a in init){if(_.isFunction(Page.initializer[init[a]])){Page.initializer[init[a]]()}}};Page.initializer=[];Page.promptReload=function(){alert("Required resources could not be loaded! Refresh the page!")};Page.setCookie=function(a,b,c){$.cookie(a,String(b),_.extend({expires:999999999,path:"/"},c))};
path={};path.ajax={};path.ajax["groups/getMembers"]="/ajax/groups/getMembers";path.ajax["groups/getNonMembers"]="/ajax/groups/getNonMembers";path.ajax["groups/addUser"]="/ajax/groups/addUser";path.ajax["groups/removeUser"]="/ajax/groups/removeUser";path.ajax["roles/getUsers"]="/ajax/roles/getUsers";path.ajax["roles/getUsersWithoutRole"]="/ajax/roles/getUsersWithoutRole";path.ajax["roles/setUserRole"]="/ajax/roles/setUserRole";path.ajax["course/getTeachers"]="/ajax/course/getTeachers";path.ajax["course/getNonTeachers"]="/ajax/course/getNonTeachers";path.ajax["course/addTeacher"]="/ajax/course/addTeacher";path.ajax["course/removeTeacher"]="/ajax/course/removeTeacher";path.ajax["course/getStudents"]="/ajax/course/getStudents";path.ajax["course/getNonStudents"]="/ajax/course/getNonStudents";path.ajax["course/addStudent"]="/ajax/course/addStudent";path.ajax["course/removeStudent"]="/ajax/course/removeStudent";path.ajax["apis/googledocs"]="/apis/googledocs";path.ajax["course/emailAllCourseUsers"]="/course/email/allCourseUsers";
Page.initializer.ajaxspinner=function(){$.fn.spin=function(c){this.each(function(){var e=$(this),d=e.data();if(d.spinner){d.spinner.stop();delete d.spinner}if(c!==false){d.spinner=new Spinner($.extend({color:e.css("color")},c)).spin(this)}});return this};function a(){var c=$(".b-spincontainer");c.hide();c.spin(false);c.remove()}var b={lines:10,length:3,width:4,radius:8,color:"#000",speed:1.4,trail:60,shadow:false};jQuery.ajaxSetup({beforeSend:function(){$('<div class="b-spincontainer"></div>').appendTo("body");var c=$(".b-spincontainer");c.spin(b);c.show()},complete:function(){a()},error:function(){a()},success:function(){a()},statusCode:{200:function(){a()},404:function(){a()},500:function(){a()}}})};
Page.initializer.flash=function(){$(".b-flash .closer").live("click",function(){$(this).parent().fadeOut()});$(".b-flash .a-reload").live("click",function(){location.reload(true);return false})};
Page.initializer.userinfo=function(){var d;$("a[data-user]").live("mouseenter",function(){clearTimeout(d);$(this).addClass("isHovered");c($(this))}).live("mouseleave",function(){$(this).removeClass("isHovered");var e=$(".popover");if(e.length>0){d=setTimeout(function(){if(true!=e.hasClass("isHovered")){e.hide(0).remove()}},1100)}});function c(i){b();var g=i.data("json");if(g!=""){var j=tmpl.render("userinfo:dialog-view",g);var e=a(j);$(i).popover(e);$(i).popover("show");return false}var f=$(i).data("user");var h=$(i).data("path");$.post(h,{userId:f,link:window.location.toString()},function(l){i.data("json",l.response);$viewDialog=tmpl.render("userinfo:dialog-view",l.response);if(i.hasClass("isHovered")){var k=a($viewDialog);$(i).popover(k);$(i).popover("show")}}).error(function(){Interface.showTemplateAsFlashMessage("userinfo:flash_error-load")});return false}function a(f){var e={offset:10,animate:false,html:true,placement:"top",content:f,trigger:"manual",delay:{show:0,hide:1100},template:'<div class="popover" onmouseover="$(this).addClass(\'isHovered\'); $(this).mouseleave(function(){$(this).removeClass(\'isHovered\'); $(this).hide(); });"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'};return e}function b(){$(".popover").hide(0).remove()}$(".l-free a[data-user]").live("click",function(){return false})};
$("#CoursePlusCourseUniversityForm_course_alias").bind("input propertychange",function(){callChecks(this)});$("#CoursePlusUserForm_course_alias").bind("input propertychange",function(){callChecks(this)});callChecks=function(a){if(""!=a.value){checkAlias(a);checkAliasStopWords(a)}};checkAlias=function(c){var b=/^[0-9a-zA-Z-]+$/;var a=b.exec(c.value);if(!a){alert("Alias should contain only digits, letters or '-' symbol")}};checkAliasStopWords=function(c){var b=/^(admin|create|delete|edit|show|update|check_password|lectrio|news|list|course|assignments|lessons|discussions)+$/;var a=b.exec(c.value);if(a){alert("Sorry, this word is reserved and can not be used")}};
$(function(){var a="10:00";var b="11:00";$("body").on("click","#event_isAllDay",toggleTimeShowing);$(".b-calendar").each(function(g,m){var j=$(m);var f=j.attr("eventSources").split(";");var c=(j.data("type")=="master")?true:false;var e=[];function k(){var i="/ajax/calendar/moderatedCourses";$.post(i,function(o){var n=[];if((typeof o.response!="undefined")&&o.response["success"]==true){n=o.response["courses"];h(j,n)}})}if(true==c){k()}else{h(j,e)}function h(p,o){var n=p.attr("eventSources").split(";");var i=[];var q=[];$.each(n,function(t,s){var v=s.split("|");var r="/ajax/calendar/"+v[0];var u={url:r,type:"POST",error:function(){Interface.showTemplateAsFlashMessage("calendar:flash_error-load")},data:{}};i.push(u);if(v[1]=="canAdd"){q.push(u)}});p.fullCalendar({firstDay:1,height:400,selectable:q.length>0,selectHint:true,allDaySlot:true,select:function(u,r,t){var s={start:u,end:r,allDay:t,source:i[0],moderatedCourses:o,isMasterCalendar:c};showEventEditDialog(s,d)},header:{left:"prev,next today",center:"title",right:""},eventDrop:function(u,s,r,v,t){d(u)},eventResize:function(u,s,r,t){d(u)},eventClick:function(t,s,r){t.moderatedCourses=o;t.isMasterCalendar=c;l(t)},eventRender:function(s,r){classesToAdd=[];if(s.metaType=="deadline"){classesToAdd.push("fc-event_deadline");if(s.submission){classesToAdd.push("fc-event_deadline_submitted")}}if(s.metaType=="event"){if(s.hasAttendanceAndGrades==true){classesToAdd.push("fc-event_attendance")}}r.addClass(classesToAdd.join(" "));r.find(":first-child").each(function(t){if(!$(this).hasClass("fc-event-title")){$(this).addClass(classesToAdd.join(" "))}});types={"0":"Custom event","1":"Class","2":"Lecture","3":"Fuck knows what"};title="";if(s.type==0&&s.typeCustomLabel){title=s.typeCustomLabel}else{title=types[s.type]}if(typeof(title)=="undefined"){title=""}r.find(".fc-event-inner").attr("title",title)},eventSources:i,loading:function(s,r){}})}var d=function(o,i){var q=new Date(o.start);var p=new Date(o.end);o.unixDateStart=q.getFullYear()+"-"+(q.getMonth()+1).toString()+"-"+q.getDate()+" "+q.getHours()+":"+q.getMinutes()+":"+q.getSeconds();o.unixDateEnd=p.getFullYear()+"-"+(p.getMonth()+1).toString()+"-"+p.getDate()+" "+p.getHours()+":"+p.getMinutes()+":"+p.getSeconds();o.start=q.toString();if(o.end==null){o.end=q.toString()}else{o.end=p.toString()}o.parentEventDateStart=o.start;o.parentEventDateEnd=o.end;var r=$.extend(true,{},o,{source:null});var n=o.source.url+(i?"/create":"/update");$.ajax({type:"POST",url:n,data:r,success:function(s){j.fullCalendar("refetchEvents")},error:function(s){Interface.showTemplateAsFlashMessage("calendar:flash_error-save")}});o.start=q.toString();o.end=p.toString();if(!o.id){o.editable=false;j.fullCalendar("renderEvent",o);j.fullCalendar("unselect")}else{j.fullCalendar("updateEvent",o)}};function l(i){tmplData={id:i.id,entityId:i.entityId,dateStart:$.datepicker.formatDate("d MM",i.start),timeStart:i.start.toTimeString().substr(0,5),isAllDay:i.allDay,metaType:i.metaType,title:i.title,location:i.location,course:i.course,description:i.description,editable:i.editable,hasAttendanceAndGrades:i.hasAttendanceAndGrades,isMasterCalendar:i.isMasterCalendar,moderatedCourses:i.moderatedCourses,course:i.course};if(i.metaType=="deadline"){tmplData.submission=i.submission;tmplData.unmarkedSubmissions=i.unmarkedSubmissions}else{tmplData.type=0;tmplData.typeLabel="Class"}if(i.end&&i.end!=i.start){tmplData.dateEnd=$.datepicker.formatDate("d MM",i.end);tmplData.timeEnd=$.fullCalendar.formatDate(i.end,"HH:mm")}else{tmplData.dateEnd=tmplData.dateStart;tmplData.timeEnd=tmplData.timeStart}$viewEventDialog=tmpl.render("calendar:dialog-view",tmplData).first("div");$viewEventDialog.dialog({width:"auto",resizable:false,modal:true,close:function(n,o){$(this).dialog("destroy").remove()}});$viewEventDialog.data("event",i);$viewEventDialog.find(".b-calendar-dialog-view__footer__edit-link").click(function(){$viewEventDialog.dialog("destroy");showEventEditDialog($viewEventDialog.data("event"),d);return false})}$(window).resize(function(){j.fullCalendar("render")})});$(".datepair").each(initDatepair)});function showEventEditDialog(b,a){if(!b.end){b.end=b.start}var c={};if(b.repetitionValue!=undefined){c={Mon:b.repetitionValue.charAt(0),Tue:b.repetitionValue.charAt(1),Wed:b.repetitionValue.charAt(2),Thu:b.repetitionValue.charAt(3),Fri:b.repetitionValue.charAt(4),Sat:b.repetitionValue.charAt(5),Sun:b.repetitionValue.charAt(6)}}$editEventDialog=tmpl.render("calendar:dialog-edit",{defaultDateStart:$.fullCalendar.formatDate(b.start,"dd/MM/yyyy"),defaultTimeStart:$.fullCalendar.formatDate(b.start,"HH:mm"),defaultDateEnd:$.fullCalendar.formatDate(b.end,"dd/MM/yyyy"),defaultTimeEnd:$.fullCalendar.formatDate(b.end,"HH:mm"),defaultIsAllDay:b.allDay?"checked='checked'":"",defaultTitle:b.title,defaultTypeCustomLabel:b.typeCustomLabel,defaultLocation:b.location,defaultDescription:b.description,defaultHasAttendanceAndGrades:(b.hasAttendanceAndGrades==0)?"":"checked='checked'",isRecurrent:b.isRecurrent,repetitionType:b.repetitionType,repetitionValue:c,repetitionEndType:b.repetitionEndType,repetitionEndValue:b.repetitionEndValue,parentEventDateStart:$.fullCalendar.formatDate(new Date(b.parentEventDateStart),"dd/MM/yyyy"),parentEventDateEnd:$.fullCalendar.formatDate(new Date(b.parentEventDateEnd),"dd/MM/yyyy"),isMasterCalendar:b.isMasterCalendar,moderatedCourses:b.moderatedCourses,course:b.course}).first("div");$editEventDialog.dialog({width:"auto",resizable:false,modal:true,close:function(d,e){$(this).dialog("destroy").remove()}});datepairDate();datepairTime();$editEventDialog.find('[class="datepair"]').each(initDatepair);toggleTimeShowing(b);$editEventDialog.submit(function(){var e=$editEventDialog.find('[id="event_dateStart_date"]').datepicker("getDate");e.setHours($editEventDialog.find('[id="event_dateStart_time"]').val().substr(0,2),$editEventDialog.find('[id="event_dateStart_time"]').val().substr(3,2),0,0);var d=$editEventDialog.find('[id="event_dateEnd_date"]').datepicker("getDate");d.setHours($editEventDialog.find('[id="event_dateEnd_time"]').val().substr(0,2),$editEventDialog.find('[id="event_dateEnd_time"]').val().substr(3,2),0,0);b.start=e.toString();b.end=d.toString();b.title=$editEventDialog.find('[id="event_title"]').val();b.location=$editEventDialog.find('[id="event_location"]').val();b.description=$editEventDialog.find('[id="event_description"]').val();b.allDay=$editEventDialog.find('[id="event_isAllDay"]').is(":checked")?1:0;b.type=$editEventDialog.find('[name="type"]').val();b.typeCustomLabel=$editEventDialog.find('[name="typeCustomLabel"]').val();b.hasAttendanceAndGrades=$editEventDialog.find('[id="event_hasAttendanceAndGrades"]').is(":checked")?1:0;b.recurrency=getRecurrency($editEventDialog);b.courseId=$editEventDialog.find('[name="event_courseId"]').val();a(b,true);$editEventDialog.dialog("destroy").remove();return false});$editEventDialog.find(".js-close-edit-event, .b-calendar__destroy-dialog a, a.ui-dialog-titlebar-close").click(function(){$editEventDialog.dialog("destroy").remove();return false});linkEventRecurrency($editEventDialog)}function linkEventRecurrency(a){a.find("#event_eventRecurrency").click(function(){a.find(".js-event-recurrency").slideToggle("fast")});a.find("#event_eventRecurrency_repetitionType-2").click(function(){a.find(".event_eventRecurrency_repetitionValue").removeAttr("disabled")});a.find("#event_eventRecurrency_repetitionType-1").click(function(){a.find(".event_eventRecurrency_repetitionValue").attr("disabled","true")});a.find('[name="event_eventRecurrency_repetitionEndType"]').click(function(){a.find('[name="event_eventRecurrency_repetitionEndValue"]').attr("disabled","true");if($(this).attr("id")=="event_eventRecurrency_repetitionEndType-3"){$(this).parent().next('[name="event_eventRecurrency_repetitionEndValue"]').removeAttr("disabled")}else{$(this).next('[name="event_eventRecurrency_repetitionEndValue"]').removeAttr("disabled")}});a.find(".event_eventRecurrency_repetitionEndValue_time").datepicker()}function getRecurrency(a){recurrency={};if(a.find("#event_eventRecurrency").is(":checked")){var c=a.find('[name="event_eventRecurrency_repetitionType"]:checked').val();recurrency.repetitionType=c;if(c==2){var d=a.find(".event_eventRecurrency_repetitionValue:checked");recurrency.repetitionValue=new Array();d.each(function(e){recurrency.repetitionValue.push($(this).val())})}var b=a.find('[name="event_eventRecurrency_repetitionEndType"]:checked').val();recurrency.repetitionEndType=b;if(b>1){if(b==2){recurrency.repetitionEndValue=a.find('[name="event_eventRecurrency_repetitionEndType"]:checked').next('[name="event_eventRecurrency_repetitionEndValue"]').val()}else{recurrency.repetitionEndValue=a.find('[name="event_eventRecurrency_repetitionEndType"]:checked').parent().next('[name="event_eventRecurrency_repetitionEndValue"]').val()}}}return recurrency}function initDatepair(){var b=$(this);var g=b.find("input.start.date");var c=b.find("input.end.date");var e=0;if(g.length&&c.length){var d=new Date(g.datepicker("getDate"));var h=new Date(c.datepicker("getDate"));e=h.getTime()-d.getTime();b.data("dateDelta",e)}var a=b.find("input.start.time");var i=b.find("input.end.time");if(a.length&&i.length){var f=a.timepicker("getSecondsFromMidnight");var j=i.timepicker("getSecondsFromMidnight");b.data("timeDelta",j-f);if(e<86400000){i.timepicker("option","minTime",f)}}}function doDatepair(){var b=$(this);var a=b.closest(".datepair");if(b.hasClass("date")){updateDatePair(b,a)}else{if(b.hasClass("time")){updateTimePair(b,a)}}}function updateDatePair(j,c){var d=c.find("input.start.date");var h=c.find("input.end.date");if(!d.length||!h.length){return}var f=new Date(d.datepicker("getDate"));var i=new Date(h.datepicker("getDate"));var b=c.data("dateDelta");if(b&&j.hasClass("start")){var g=new Date(f.getTime()+b);h.datepicker("setDate",g);return}else{var e=i.getTime()-f.getTime();if(e<0){e=0;if(j.hasClass("start")){h.datepicker("setDate",f)}else{if(j.hasClass("end")){d.datepicker("setDate",i)}}}if(e<86400000){var a=c.find("input.start.time").val();if(a){c.find("input.end.time").timepicker("option",{minTime:a})}}else{c.find("input.end.time").timepicker("option",{minTime:null})}c.data("dateDelta",e)}}function updateTimePair(k,c){var d=c.find("input.start.time");var h=c.find("input.end.time");if(!d.length||!h.length){return}var i=d.timepicker("getSecondsFromMidnight");var n=h.timepicker("getSecondsFromMidnight");var b=c.data("timeDelta");var g=c.data("dateDelta");if(k.hasClass("start")&&(!g||g<86400000)){h.timepicker("option","minTime",i)}var m=0;var e;if(b&&k.hasClass("start")){var f=(i+b)%86400;if(f<0){f+=86400}h.timepicker("setTime",f);e=f-i}else{if(i!==null&&n!==null){e=n-i}else{return}}c.data("timeDelta",e);if(e<0&&(!b||b>0)){var m=86400000}else{if(e>0&&b<0){var m=-86400000}}var a=c.find(".start.date");var l=c.find(".end.date");if(a.val()&&!l.val()){l.datepicker("setDate",a.val());g=0;c.data("dateDelta",0)}if(m!=0){if(g||g===0){var j=new Date(l.datepicker("getDate"));var f=new Date(j.getTime()+m);l.datepicker("setDate",f);c.data("dateDelta",g+m)}}}var datepairDate=function(){$(".datepair input.date").each(function(){var b=$(this);var a={minDate:0};if(b.hasClass("future")){a.minDate=new Date()}if(b.hasClass("start")||b.hasClass("end")){a.onSelect=doDatepair}b.datepicker(a)})};var datepairTime=function(){$(".datepair input.time").each(function(){var b=$(this);var a={showDuration:true,timeFormat:"H:i"};if(b.hasClass("start")||b.hasClass("end")){a.onSelect=doDatepair}b.timepicker(a)})};var toggleTimeShowing=function(a){$timeStart=$("#event_dateStart_time");$timeEnd=$("#event_dateEnd_time");timeStartVal=$timeStart.val();timeEndVal=$timeEnd.val();$isAllDay=$("#event_isAllDay");if($isAllDay.is(":checked")){$timeStart.prop("disabled",true);$timeEnd.prop("disabled",true);if($timeStart.val()!="00:00"&&$timeEnd.val()!="00:00"){$timeStart.val("00:00");$timeEnd.val("00:00")}}else{$timeStart.prop("disabled",false);$timeEnd.prop("disabled",false);if(typeof a.title==="undefined"){$timeStart.val("Choose");$timeEnd.val("Time")}else{$timeStart.val(timeStartVal);$timeEnd.val(timeEndVal)}}};
$(".js-course-users").live("click",function(b){b.preventDefault();var a=$(this).data("coursealias");$.ajax({type:"POST",url:path.ajax["course/getStudents"],data:{courseAlias:a},success:function(d){if(typeof d.response!="undefined"){c(d.response)}}});function c(d){$usersDialog=tmpl.render("course-users:course-users",{students:d}).first("div");$usersDialog.dialog({title:"Students on this course",width:"auto",resizable:false,modal:true,close:function(e,f){$(this).dialog("destroy").remove()}});$usersDialog.find(".cancel-link").click(function(){$usersDialog.dialog("destroy").remove();return false})}});
$(function(){$(".b-dialog_unigroup-members__show-dialog-link").click(function(){var c=$(this).attr("unigroupName");var b=$(this).attr("unigroupId");a(b,c)});$(".p-course-administration-students__view-group").click(function(){var b=$(this).parent().children("select").val();var c=$(this).parent().children("select").find("option:selected").text();if(b!==undefined&&b>0){a(b,c)}return false});function a(b,c){$.ajax({type:"POST",url:path.ajax["groups/getMembers"],data:{unigroupId:b},success:function(d){if(typeof d.response!="undefined"){$unigroupDialog=tmpl.render("unigroup:dialog-unigroup-member-list",{unigroupName:c,students:d.response});$unigroupDialog.dialog({width:500,resizable:false,modal:true});return false}}})}});
$(".js-email-all-users").live("click",function(a){$emailDialog=tmpl.render("email-all-users:email-all-users").first("div");$emailDialog.dialog({width:"auto",resizable:false,modal:true,close:function(b,c){$(this).dialog("destroy").remove()}});$emailDialog.find(".cancel-link").click(function(){$emailDialog.dialog("destroy").remove();return false});$emailDialog.submit(function(g){var f=$(this);g.preventDefault();var c=$.url().segment(2);var b=path.ajax["course/emailAllCourseUsers"];var d=f.find("#email-all-users-body").val();$.post(b,{courseAlias:c,message:d},function(e){if(e.response["success"]==false){alert(e.response["errorMessages"][0])}f.dialog("destroy").remove()})});return false});
$(".b-files-panel__download").live("click",function(){var b=$(this).parent().find(".b-files-panel__data-link").data("link");if(b!==undefined){window.open(b,"_blank")}var a=$(this).parent().find(".b-files-panel__data-link").data("downloadlink");if(a!==undefined){window.open(a,"_blank")}return false});var originalContent=$(".b-formatted-content").html();$(".b-files-panel-content").live("click",function(){$(".b-formatted-content").html(originalContent);$(".b-files-panel>ul>li").removeClass("b-files-panel__active-document");$(this).addClass("b-files-panel__active-document");$(".b-formatted-content").removeClass("b-content-panel__preview");return false});$(".b-files-panel>ul>li").live("click",function(){var f=$(this);var j=["doc","docx","pdf"];var k=f.find(".b-files-panel__data-link").data("ext");var d=540;if($.inArray(k,j)!=-1){d=900}if(k!==undefined){if(f.hasClass("b-files-panel__active-document")==false){$(".b-files-panel>ul>li").removeClass("b-files-panel__active-document");f.addClass("b-files-panel__active-document");var a=f.find(".b-files-panel__download").text();var b=f.find(".b-files-panel__data-link").data("id");if(b!==undefined){var g='<div class="b-content-panel__preview-iframe"><iframe src="https://docs.google.com/viewer?authuser=0&srcid='+b+'&pid=explorer&a=v&chrome=false&embedded=true" style="width:100%; margin-left: -2px; margin-top: -2px;" height="'+d+'"></iframe></div>';if(a!==undefined){var h=$(this).find(".b-files-panel__data-link").data("downloadlink")}}else{var h=f.find(".b-files-panel__data-link").data("link");if(h!==undefined){var g='<div class="b-content-panel__preview-iframe"><iframe src="http://docs.google.com/gview?url='+h+'&embedded=true" style="width:100%; margin-left: -2px; margin-top: -2px;" height:'+d+'px; " frameborder="0"></iframe></div>'}}var i=f.find(".b-files-panel__data-link").data("title");if(i!==undefined){var c=f.find(".b-files-panel__data-link").attr("title");g="<h3>"+i+' <small><a href="'+h+'" target="_blank" title="'+c+'">'+a+"<a/></small></h3>"+g}var e=["jpg","png","jpeg","gif","bmp"];if(jQuery.inArray(k,e)!=-1){g='<div class="b-content-panel__preview-image"><img src="'+h+'"/></div>'}$(".b-formatted-content").addClass("b-content-panel__preview");$(".b-formatted-content").html(g)}else{$(".b-formatted-content").html(originalContent);$(".b-formatted-content").removeClass("b-content-panel__preview");f.removeClass("b-files-panel__active-document")}}else{dlink=f.find("a.b-files-panel__download").attr("href");if(dlink!==undefined){window.open(dlink)}}return false});
Page.initializer["b-googledocs-bar"]=function(){var a=$.url().segment(2);var b=$(location).attr("href");if(!a){return}$barContainer=$(".b-googledocs-bar");if($barContainer.length==1){$.post(path.ajax["apis/googledocs"],{courseAlias:a,googledocsRealCallbackUrl:b},function(c){if(c.response.authorized==false){$connectButton=tmpl.render("googledocs:connect-button",c.response);$barContainer.append($connectButton)}else{if(c.response.list==null){$barContainer.append("Course creator has not enabled Google Docs for this course");return}$barContainer.dynatree({onActivate:function(d){if(d.data.href){window.open(d.data.href)}},persist:true,selectMode:1,imagePath:"/i/icons",children:[c.response.list],dnd:{onDragStart:function(d){if(d.data.isFolder){return false}return true},preventVoidMoves:true,onDragStop:function(d){logMsg("tree.onDragStop(%o)",d)}}})}}).error(function(){$barContainer.append("Sorry, we had some problems with retrieving google docs for current course.")})}};
$(function(){var a=$(".b-journal-content");a.addClass("b-journal-content_slidable");var k=$(".b-journal-content__elements");var o=$(".b-journal-content__shadow-left");var m=$(".b-journal-content__shadow-right");var j=$(".b-journal-content__table-container");var n=$(".b-journal-content-table");var b;var g;var l;var e=a.find(".b-journal-content__slider");var h=$("<div>").addClass("ui-slider ui-slider-horisontal ui-widget ui-widget-content ui-corner-all").append("<div>");var i=h.find("div").css("margin","0 auto").slider().removeClass("ui-widget ui-widget-content ui-corner-all");var d=i.find(".ui-slider-handle");i.bind("slide",function(p,q){f(q.value)});var f=function(p){if(p===undefined){p=n.data("offset")||0}if(p>b){p=b}n.data("offset",p);j.css("margin-left","-"+p+"px");o.toggle(p>0);m.toggle(p<b);if(i.slider("option","value")!=p){i.slider("option","value",p)}};var c=function(p){if(!p&&a.width()==a.data("prevWidth")){return}a.data("prevWidth",a.width());if(n.width()<a.width()){h.detach();o.hide();m.hide();j.css("margin-left","0px")}else{e.append(h);b=n.width()-k.width()+1;g=k.width()/n.width();l=e.width()*g;i.slider("option","max",n.width()-k.width()+1);d.css({});f()}};n.bind("columnschange",function(){c(true)});$(window).resize(c);c()});
$(function(){$(".b-rounded-list-item_media__delete").live("click",function(){var b=$(this).attr("mediaId");var a=$(this).attr("deleteUrl");var c=$(this);$.ajax({type:"POST",url:a,data:{mediaId:b},success:function(d){c.parent().remove()},error:function(){alert("There was an error while deleting the file.")}});return false})});
$(function(){$(".b-rounded-list-item__delete").live("click",function(){var b=$(this).attr("mediaId");var a=$(this).attr("deleteUrl");var c=$(this);tmplData={question:'Remove "'+$(this).attr("userName")+'"?',questionNote:"This user will not have access to this account anymore.",formSubmitPath:$(this).attr("path"),confirmButtonValue:"Remove User",variableToDeleteName:$(this).attr("variableName"),variableToDeleteValue:$(this).attr("variableValue"),};$deleteDialog=tmpl.render("confirmation-dialog:dialog-delete",tmplData).first("div");$deleteDialog.dialog({width:400,resizable:false,modal:true});$deleteDialog.find(".button-cancel").click(function(){$deleteDialog.dialog("destroy");return false});return false})});
Page.initializer["js-sortable"]=function(){$(".js-sortable__column").click(function(){var b=$(this).children(".js-sortable__column-arrow");a(b)});$(".js-sortable__column-arrow").click(function(){a($(this))});function a(c){var b=c.attr("abbr");$(".js-sortable li").tsort("span",{order:"asc",data:b});$(".js-sortable__column-arrow").removeClass("js-sortable__active");$(".js-sortable__column-arrow").parent().removeClass("js-sortable__active");c.addClass("js-sortable__active");c.parent().addClass("js-sortable__active")}};
$(function(){var b=$(".b-switcher_js");var c=$(".b-catalog__item_course-public");var d=$(".b-catalog__item_course-private");$switcherButtons=b.find("a.b-switcher__button");var a=function(e){var f=[];e=parseInt(e);switch(e){case 1:c.toggle(true);d.toggle(true);break;case 2:c.toggle(true);d.toggle(false);break;case 3:c.toggle(false);d.toggle(true);break;default:return}$switcherButtons.removeClass("b-switcher__button_selected");$activeElement=b.find("[value="+e+"]").addClass("b-switcher__button_selected")};$switcherButtons.click(function(){a(this.getAttribute("value"));return false})});
$(function(){var c=$(".b-switcher_js");var b=$(".b-journal-content");var d=$(".b-journal-content__table-container");if(!c.length||!b.length){return}$switcherButtons=c.find("a.b-switcher__button");var a=function(f){var g=[];f=parseInt(f);switch(f){case 1:break;case 2:g=["assignment"];break;case 3:g=["event"];break;default:return}$switcherButtons.removeClass("b-switcher__button_selected");$activeElement=c.find("[value="+f+"]").addClass("b-switcher__button_selected");var e=[];$table=b.find("table");$tableClone=$table.clone(true);$table.detach();d.append($tableClone);$table.find("th").each(function(h){$element=$(this);if(g.indexOf($element.attr("type"))===-1){e.push(h);$element.show()}else{$element.hide()}});$table.find("tr").each(function(){$(this).find("td").each(function(h){$(this).toggle(e.indexOf(h)!==-1)})});tableEvents=$table.data("events");$tableClone.remove();d.append($table);$table.trigger("columnschange")};$switcherButtons.click(function(){a(this.getAttribute("value"));return false});a(1);c.removeClass("b-switcher_hidden")});
$(function(){var c=$(".b-switcher_js");$list=$(".b-rounded-list");var d=$(".b-rounded-list-item_user-pending").clone();var f=$(".b-rounded-list-item_user-member").clone();var e=$list.html();var b=$(".b-total_users").text();$switcherButtons=c.find("a.b-switcher__button");$membersLadel=$("#b-switcher__user-member").html();$("#b-switcher__user-member").html($membersLadel+" ("+$(".b-rounded-list-item_user-member").length+")");$pendingLadel=$("#b-switcher__user-pending").html();$("#b-switcher__user-pending").html($pendingLadel+" ("+$(".b-rounded-list-item_user-pending").length+")");var a=function(g){var h=[];g=parseInt(g);switch(g){case 1:$list.html(e);break;case 2:$list.html(f);break;case 3:$list.html(d);break;default:return}$switcherButtons.removeClass("b-switcher__button_selected");$activeElement=c.find("[value="+g+"]").addClass("b-switcher__button_selected")};$switcherButtons.click(function(){a(this.getAttribute("value"));return false})});
$(function(){var c=$(".b-switcher_js");var b=$(".p-usermanagement-roles__privileges-container");var d=$(".p-usermanagement-roles__users-container");$switcherButtons=c.find("a.b-switcher__button");var a=function(e){var f=[];e=parseInt(e);switch(e){case 1:b.toggle(true);d.toggle(false);break;case 2:d.toggle(true);b.toggle(false);break;default:return}$switcherButtons.removeClass("b-switcher__button_selected");$activeElement=c.find("[value="+e+"]").addClass("b-switcher__button_selected")};$switcherButtons.click(function(){a(this.getAttribute("value"));return false})});
!function(e,a,f){var c,b=e.getElementsByTagName(a)[0];if(!e.getElementById(f)){c=e.createElement(a);c.id=f;c.src="//platform.twitter.com/widgets.js";b.parentNode.insertBefore(c,b)}}(document,"script","twitter-wjs");
Page.initializer["p-course-administration-disenroll"]=function(){var a=$.url().segment(2);if(!a){return}$(".b-rounded-list-item__disenroll").live("click",function(){var d=$(this);var c=$(this).attr("variableValue");var b=d.data("path");tmplData={question:'Remove "'+$(this).attr("userName")+'"?',questionNote:"This user will not have access to this course anymore.",formSubmitPath:b,confirmButtonValue:"Remove User",variableToDeleteName:$(this).attr("variableName"),variableToDeleteValue:c,};$deleteDialog=tmpl.render("confirmation-dialog:dialog-delete",tmplData).first("div");$deleteDialog.dialog({width:400,resizable:false,modal:true});$deleteDialog.find(".button-cancel").click(function(){$deleteDialog.dialog("destroy");return false});$(".button-submit").click(function(){$.post(b,{userId:c,courseId:a},function(e){$(".b-flash").remove();$(".b-title-page").before(e.response.flashView);if(e.response.success==1){d.parent().remove();$totalUsers=$(".b-rounded-list-item_user-list_total-users");$totalUsers.text((parseInt($totalUsers.text())-1))}$deleteDialog.dialog("destroy")});return false});return false})};
Page.initializer["p-course-administration-settings"]=function(){$(".p-administration_settings__delete-course").click(function(){tmplData={question:'Delete "'+$(this).data("coursename")+'"?',questionNote:"This action will delete this course permanently.",formSubmitPath:$(this).data("action"),confirmButtonValue:"Delete Course",variableToDeleteName:$(this).data("variableName"),variableToDeleteValue:$(this).data("variableValue"),};$deleteDialog=tmpl.render("confirmation-dialog:dialog-delete",tmplData).first("div");$deleteDialog.dialog({width:400,resizable:false,modal:true});$deleteDialog.find(".button-cancel").click(function(){$deleteDialog.dialog("destroy");return false});return false})};
Page.initializer["p-course-administration-students"]=function(){var a=$.url().segment(2);if(!a){return}var b={updateMembersPath:path.ajax["course/getStudents"],updateCandidatesPath:path.ajax["course/getNonStudents"],addUserPath:path.ajax["course/addStudent"],removeUserPath:path.ajax["course/removeStudent"],defaultAjaxData:{courseAlias:a}};Interface.userStack.init(b);$(".p-course-administration-students__remove-unigroup").click(function(){tmplData={question:'Remove "'+$(this).attr("unigroupName")+'" from this course?',questionNote:"Grades and submissions of students in this group will not be available anymore.",formSubmitPath:$(this).attr("path"),confirmButtonValue:"Remove Group",variableToDeleteName:$(this).attr("variableName"),variableToDeleteValue:$(this).attr("variableValue"),};$deleteDialog=tmpl.render("confirmation-dialog:dialog-delete",tmplData).first("div");$deleteDialog.dialog({width:500,resizable:false,modal:true});$deleteDialog.find(".button-cancel").click(function(){$deleteDialog.dialog("destroy");return false});return false})};
Page.initializer["p-course-administration-teachers"]=function(){var a=$.url().segment(2);if(!a){return}var b={updateMembersPath:path.ajax["course/getTeachers"],updateCandidatesPath:path.ajax["course/getNonTeachers"],addUserPath:path.ajax["course/addTeacher"],removeUserPath:path.ajax["course/removeTeacher"],defaultAjaxData:{courseAlias:a}};Interface.userStack.init(b)};
Page.initializer["p-course-assignment-base"]=function(){$(".publish").click(function(){$this=$(this);assignmentID=$.url($this.parent().find("a:first").attr("href")).segment(4);$.ajax({type:"POST",url:"/ajax/assignments/assignment/publish",data:{assignmentId:assignmentID},success:function(b){$this.parent().parent().parent().removeClass("not_published");$this.parent().find(".not_published").removeClass("not_published");$this.remove();$(".b-flash-container").append($("#b-flash_notice_assignment_publish").tmpl())}})});$("#assignmentSubmissionGrade_isPassed").buttonset();var a=$("#assignment_isSubmissionsCommentableByStudents").attr("checked");$("#assignment_isSubmissionsCommentableByStudents").change(function(b){a=$("#assignment_isSubmissionsCommentableByStudents").attr("checked")});$("#assignment_isSubmissionsVisibleForStudents").change(function(b){if($(this).is(":checked")){$("#assignment_isSubmissionsCommentableByStudents").removeAttr("disabled");$("#assignment_showStudentsSumbmissionsAfterSubmit_1").removeAttr("disabled");$("#assignment_showStudentsSumbmissionsAfterSubmit_0").removeAttr("disabled");if(typeof a==="undefined"){$("#assignment_isSubmissionsCommentableByStudents").attr("checked","checked")}else{$("#assignment_isSubmissionsCommentableByStudents").attr("checked",a)}}else{$("#assignment_isSubmissionsCommentableByStudents").attr("disabled","disabled");$("#assignment_isSubmissionsCommentableByStudents").removeAttr("checked");$("#assignment_showStudentsSumbmissionsAfterSubmit_0").attr("disabled","disabled");$("#assignment_showStudentsSumbmissionsAfterSubmit_1").attr("disabled","disabled")}})};
Page.initializer["p-course-assignment-show"]=function(){Interface.discussions()};
Page.initializer["p-course-calendar-event-show"]=function(){var e=$.url().segment(2);var a=parseInt($.url().segment(5));var f="/ajax/calendar/course/"+e+"/event/";$(".js-edit-event").live("click",function(o){o.preventDefault();var n=$(this);var m=n.data("eventid");var l=n.data("alias");var q=n.data("cid");var p=false;var k="/course/"+l+"/calendar/get/event/"+m;$.post(k,function(s){if(s.response["success"]==true){courseEvent=s.response["event"];var t=new Date();var r=t.getTimezoneOffset()*60000;courseEvent.start=new Date(courseEvent.start*1000+r);courseEvent.end=new Date(courseEvent.end*1000+r);courseEvent.parentEventDateStart=new Date(courseEvent.parentEventDateStart*1000+r);courseEvent.parentEventDateEnd=new Date(courseEvent.parentEventDateEnd*1000+r);p=courseEvent.hasAttendanceAndGrades;showEventEditDialog(courseEvent,j)}});var j=function(t,r){var s="/ajax/calendar/course/"+q+"/events/create";var v=new Date(t.start);var u=new Date(t.end);t.unixDateStart=v.getFullYear()+"-"+(v.getMonth()+1).toString()+"-"+v.getDate()+" "+v.getHours()+":"+v.getMinutes()+":"+v.getSeconds();t.unixDateEnd=u.getFullYear()+"-"+(u.getMonth()+1).toString()+"-"+u.getDate()+" "+u.getHours()+":"+u.getMinutes()+":"+u.getSeconds();t.start=v.toString();if(t.end==null){t.end=v.toString()}else{t.end=u.toString()}t.parentEventDateStart=t.start;t.parentEventDateEnd=t.end;var w=$.extend(true,{},t,{source:null});$.ajax({type:"POST",url:s,data:w,success:function(y){if(t.hasAttendanceAndGrades!=p){window.location.replace(window.location.pathname)}$("#eventTitle").text(t.title);if(t.location!=""){if($("#eventLocation").length==0){var x='<p><b>Location &nbsp;</b><span id="eventLocation"> '+t.location+"</span></p>";$("#eventTimeRange").after(x)}else{$("#eventLocation").text(t.location)}}else{$("#eventLocation").parent().remove()}if(t.description!=""){if($("#eventDescription").length==0){var z='<p id="eventDescription">'+t.description+"</p>";if($("#eventLocation").length>0){$("#eventLocation").after(z)}else{$("#eventTimeRange").after(z)}}else{$("#eventDescription").text(t.description)}}else{$("#eventDescription").remove()}t.start=v;t.end=u;tmplData={dateStart:$.datepicker.formatDate("d MM",t.start),timeStart:t.start.toTimeString().substr(0,5),isAllDay:t.allDay,metaType:t.metaType,};if(t.metaType=="deadline"){tmplData.submission=t.submission;tmplData.unmarkedSubmissions=t.unmarkedSubmissions}else{tmplData.type=0;tmplData.typeLabel="Class"}if(t.end&&t.end!=t.start){tmplData.dateEnd=$.datepicker.formatDate("d MM",t.end);tmplData.timeEnd=$.fullCalendar.formatDate(t.end,"HH:mm")}else{tmplData.dateEnd=tmplData.dateStart;tmplData.timeEnd=tmplData.timeStart}$viewEventDialog=tmpl.render("calendar:time-range",tmplData).first("div");$("#eventTimeRange").html($viewEventDialog)},error:function(x){Interface.showTemplateAsFlashMessage("calendar:flash_error-save")}})}});var b=function(j){var k=j.parents("tr").find(".b-table-catalog_event-attendees__name a");return parseInt(k.attr("data-user"))};var i=function(j){var k=j.parents("tr").find(".b-table-catalog_event-attendees__updating-state");if(!k.children().size()){k.html(tmpl.render("updating-state"));k.data("updating-count",1)}else{k.data("updating-count",k.data("updating-count")+1)}};var d=function(j){var k=j.parents("tr").find(".b-table-catalog_event-attendees__updating-state");k.data("updating-count",k.data("updating-count")-1);if(k.data("updating-count")<=0){k.empty()}};$(".b-attendance").live("click",function(){var m=$(this);var l=m.parent();var k=b(m);var j;if(m.hasClass("b-attendance_selected")){j="UNDEFINED"}else{if(m.hasClass("b-attendance_status_attended")){j="ATTENDED"}else{j="NOT_ATTENDED"}}i(m);$.ajax({type:"POST",url:f+"update-attendance",data:{eventId:a,userId:k,status:j},success:function(n){l.find(".b-attendance_status_attended").toggleClass("b-attendance_selected",j=="ATTENDED");l.find(".b-attendance_status_not-attended").toggleClass("b-attendance_selected",j=="NOT_ATTENDED");d(m)},error:function(n){Interface.showTemplateAsFlashMessage("user-stack:flash_error-save");d(m)}});return false});var h=function(j){j.data("prevValue",j.val())};var c=function(j){return j.data("prevValue")==j.val()};var g=function(j,n){if(c(n)){return false}var k=b(n);var m=(n.attr("tag")=="textarea")?n.text():n.val();h(n);i(n);var l={eventId:a,userId:k};l[j]=m;$.ajax({type:"POST",url:f+"update-"+j,data:l,success:function(o){d(n)},error:function(o){Interface.showTemplateAsFlashMessage("user-stack:flash_error-save");d(n)}});return false};$.each([{property:"grade",control:".b-table-catalog_event-attendees__grade input"},{property:"note",control:".b-table-catalog_event-attendees__note textarea"}],function(j,k){$(k.control).live("focus",function(){h($(this))});$(k.control).live("blur",function(){g(k.property,$(this))});$(k.control).live("keypress",function(l){if(l.keyCode==10||l.keyCode==13){if(!l.shiftKey){g(k.property,$(this));return false}}})})};
Page.initializer["p-course-discussion-create"]=function(){$(".js-create-discussion").on("submit",function(){$(this).submit();return false})};
Page.initializer["p-course-discussion-show"]=function(){Interface.discussions();$("#p-course-discussion-show__delete").click(function(){tmplData={question:'Delete "'+$(this).attr("discussionName")+'"?',questionNote:"This action will delete discussion and all the comments.",formSubmitPath:$(this).attr("path"),confirmButtonValue:"Delete Discussion",variableToDeleteName:$(this).attr("variableName"),variableToDeleteValue:$(this).attr("variableValue"),};$deleteDialog=tmpl.render("confirmation-dialog:dialog-delete",tmplData).first("div");$deleteDialog.dialog({width:400,resizable:false,modal:true});$deleteDialog.find(".button-cancel").click(function(){$deleteDialog.dialog("destroy");return false});return false})};
Page.initializer["p-course-lesson-base"]=function(){var a;$(".publish").click(function(){$this=$(this);a=$.url($this.parent().find("a:first").attr("href")).segment(4);$.ajax({type:"POST",url:"/ajax/lessons/publishLesson",data:{lessonId:a},success:function(b){$this.parent().parent().parent().removeClass("not_published");$this.parent().find(".not_published").removeClass("not_published");$this.remove();$(".b-flash-container").append($("#b-flash_notice_lesson_publish").tmpl())}})})};
Page.initializer["p-course-lesson-list"]=function(){var a;var c;var b;$("#sortable").sortable();$("#sortable").disableSelection();$("#sortable").sortable({handle:".drag"});$("#sortable").sortable({start:function(d,e){a=e.item.index()+1}});$("#sortable").sortable({stop:function(d,e){newItemPosition=e.item.index()+1;b=e.item.attr("id");if(a!=newItemPosition){e.item.children(".ordinal").html(newItemPosition);e.item.children(".ordinal").addClass("changed");$(".ordinal").each(function(f){if(!$(this).hasClass("changed")&&$(this).text()>=newItemPosition){$(this).html(f+1)}if(!$(this).hasClass("changed")&&$(this).text()<=newItemPosition){$(this).html(f+1)}});e.item.children(".ordinal").removeClass("changed");$.ajax({type:"POST",url:"/ajax/lessons/changeOrdinal",data:{lessonId:b,ordinal:newItemPosition},success:function(f){}})}}});$(".drag").mousedown(function(){})};
Page.initializer["p-course-lesson-show"]=function(){Interface.discussions();function a(f,c){var b=$.trim(f);var d=document.createElement("span");var e=b.length;d.style.visibility="hidden";d.style.padding="0px";document.body.appendChild(d);d.innerHTML=b;if(d.offsetWidth>c){b=b.substring(0,11)+"..."+b.substr(-11,11)}document.body.removeChild(d);return b}$(".b-files-panel ul li p a").each(function(b){var c=a($(this).text(),215);$(this).text(c)})};
Page.initializer["p-course-news-show"]=function(){var n="settings_news_filter";var a=$(".b-news-element_thumb input[type=checkbox]");var k=$(".b-news-entries");var g=[];var l=$.url().attr("path")+"/list";var f=function(e){a.each(function(){$this=$(this);$this.prop("checked",_.indexOf(g,$this.attr("name"))!=-1)});Page.setCookie(n,g.join(","));$.post(l,{kindFilter:g,offset:0,count:20},function(o){k.html(o);$(".b-news-element__content__text").each(function(){var p=$(this);txt=p.html();p.html(linkify(txt))});if(e!=undefined){$("#"+e).parent().find(".js-news-comments-container").show()}})};var m=[];a.each(function(){m.push($(this).attr("name"))});var j=$.cookie(n);try{j=j.split(",");_.each(j,function(e){if(_.indexOf(m,e)==-1){throw"wrong filter!"}});g=_.uniq(j)}catch(i){g=_.clone(m)}a.change(function(){$this=$(this);if($this.prop("checked")){g.push($this.attr("name"));g=_.uniq(g)}else{g=_.without(g,$this.attr("name"))}f();return false});f();a.prop("disabled",false);function d(e){$.ajax({type:"POST",url:$.url().attr("path")+"/save",data:e,success:function(){$("#announcement_comment").val("");f()}})}$(".js-news-form-create").submit(function(){var e=$(this).serializeArray();d(e);f();return false});var c=false;var h=20;$(window).scroll(function(){if($(window).scrollTop()>=$(document).height()-$(window).height()){if(c==false){c=true;$.post(l,{kindFilter:g,offset:h,count:20},function(e){k.append(e);h+=20;if($(e).children(".b-news-element__content").length>0){c=false}})}}});$(".js-news-comments-anchor").live("click",function(){$(this).parents(".b-news-element").find(".js-news-comments-container").slideToggle("fast");$(this).parent().remove();return false});$(".js-course-news-comment-form").live("submit",function(){var o=$(this).serializeArray();var e=$(this).parents(".b-news-element");b(o,e);return false});function b(o,e){if(o[0]["value"]!=""){$.ajax({type:"POST",url:$.url().attr("path")+"/comments/add",data:o,success:function(p){if(p.response["success"]==true){if(p.response["params"]["comment"]!=""){e.find(".js-news-comments-container").append(e.find("ul.js-news-allcomments-container>.js-news-comment"));e.find(".js-news-comments-container").after(p.response["params"]["comment"]);e.find(".auto-resize").val("");if(p.response["params"]["commentsLink"]!=""){if(e.find(".js-news-comments-container").css("display")=="none"){e.find(".js-news-comments-count").remove();e.find(".js-news-allcomments-container").prepend(p.response["params"]["commentsLink"])}}}else{f("js-news-comments-"+o[1]["value"])}}else{alert(p.response["errorMessages"][0])}}})}}$(".js-news-comments-remove-anchor").live("click",function(){var e=$(this);$.ajax({type:"POST",url:$.url().attr("path")+"/comments/delete",data:{commentId:$(this).attr("commentId")},success:function(p){if(p.response==true){var q=e.parents(".js-news-allcomments-container");e.parents(".js-news-comment").remove();var o=q.find(".js-news-comment").length;if(o==1){q.find(".js-news-comments-count").remove()}else{newCommentsAnchorText="Load more comments("+o.toString()+")";q.parents(".b-news-element").find(".js-news-comments-anchor").text(newCommentsAnchorText)}if(e.parents(".js-news-comment").parent().hasClass("js-news-comments-container")==false){q.find(".js-news-comments-container").children("li:last").insertAfter(q.find(".js-news-comments-container"))}}}});return false});$(".js-news-remove-anchor").live("click",function(){var e=$(this);$.ajax({type:"POST",url:$.url().attr("path")+"/delete",data:{newsEntryId:$(this).attr("newsEntryId")},success:function(o){if(o.response==true){e.parents(".b-news-element").remove()}}});return false})};
Page.initializer["p-user-show"]=function(){$("a[rel=popover]").popover({placement:"bottom",delay:0,animation:true})};
Page.initializer["p-usermanagement-roles"]=function(){var b=function(j){var g=j.parent().find("div");if(g.size()>0&&!j.attr("disabled")){var i=j.is(":checked");var h=g.find("input:checkbox");if(!i){h.attr("checked",h.prop("checked"));h.prop("checked",false)}else{h.prop("checked",h.attr("checked"))}g.find("input:checkbox").attr("disabled",!i)}};var d=$(".p-usermanagement-roles__privileges input:checkbox");d.each(function(){b($(this))});d.change(function(){b($(this))});$dialogDelete=$("#dialog_delete-role").tmpl().first("div");$(".p-usermanagement-roles__delete a").click(function(){$dialogDelete.dialog({resizable:false,modal:true});return false});$dialogDelete.find(".button-cancel").click(function(){$dialogDelete.dialog("destroy");return false});Interface.enableTitleRename();var a=parseInt($.url().segment(3));roles={};$(".b-content_leftcol ul.list li").each(function(){var g=$(this).text();var h=$.url($(this).find("a").attr("href")).segment(3);if(!h){h=a}roles[h]=g});var e=roles[a];var c=null;var f={updateMembersPath:path.ajax["roles/getUsers"],updateCandidatesPath:path.ajax["roles/getUsersWithoutRole"],addUserPath:path.ajax["roles/setUserRole"],removeUserPath:path.ajax["roles/setUserRole"],defaultAjaxData:{roleId:a},customRemoveUser:function(g){$dialogSetRole=$("#dialog_set-role").tmpl(g.data("user")).first("div");var h=$dialogSetRole.find("ul.roles");_.map(roles,function(i,k){if(k==a){return}var j=$('<a href="#"></a>').text(i);j.click(function(){c=k;Interface.userStack.removeUser(g,{roleId:k});$dialogSetRole.dialog("destroy");return false});h.append($("<li></li>").append(j))});$dialogSetRole.find(".button-cancel").click(function(){$dialogSetRole.dialog("destroy");return false});$dialogSetRole.dialog({resizable:false,modal:true});return false},customAddUser:function(h,g){h.data("user")["role"]={id:a,name:e};Interface.userStack.addUser(h);return false},hookAfterRemove:function(h,g){h.data("user")["role"]={id:c,name:roles[c]}}};Interface.userStack.init(f)};
Page.initializer["p-usermanagement-unigroup"]=function(){Interface.enableTitleRename();var a=parseInt($.url().segment(3));if(!a){return}var b={updateMembersPath:path.ajax["groups/getMembers"],updateCandidatesPath:path.ajax["groups/getNonMembers"],addUserPath:path.ajax["groups/addUser"],removeUserPath:path.ajax["groups/removeUser"],defaultAjaxData:{unigroupId:a}};Interface.userStack.init(b);$(".p-usermanagement-unigroup__delete-unigroup").click(function(){tmplData={question:'Delete "'+$(this).attr("unigroupName")+'"?',questionNote:"This action will delete this group permanently.",formSubmitPath:$(this).attr("path"),confirmButtonValue:"Delete Group",variableToDeleteName:$(this).attr("variableName"),variableToDeleteValue:$(this).attr("variableValue"),};$deleteDialog=tmpl.render("confirmation-dialog:dialog-delete",tmplData).first("div");$deleteDialog.dialog({width:400,resizable:false,modal:true});$deleteDialog.find(".button-cancel").click(function(){$deleteDialog.dialog("destroy");return false});return false})};